{% extends 'base.html' %}
{% load static %}
{% block title %}View Evidence - {{ evidence.description }}{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/evidence/view_evidence.css' %}?v={{ STATIC_VERSION }}" />

<div class="view-case-container">
  <div class="view-case-header">
    <h1 class="view-case-title">{{ evidence.description }}</h1>
    <div class="view-case-meta">
      <div class="view-case-meta-item">
        <span class="view-case-meta-label">Case:</span>
        <span class="view-case-meta-value">{{ evidence.case.case_id }}</span>
      </div>
      <div class="view-case-meta-item">
        <span class="view-case-meta-label">Uploaded By:</span>
        <span class="view-case-meta-value">{% if evidence.uploaded_by %}{{ evidence.uploaded_by.get_full_name }}{% else %}N/A{% endif %}</span>
      </div>
      <div class="view-case-meta-item">
        <span class="view-case-meta-label">Date Uploaded:</span>
        <span class="view-case-meta-value">{{ evidence.date_uploaded|date:"F d, Y g:i A" }}</span>
      </div>
    </div>
  </div>

  <div class="view-case-section">
    <h2 class="view-case-section-title">Evidence Preview</h2>
    <div class="view-case-preview-container">
      {% if evidence.media_type == 'image' %}
      <img src="{% url 'evidence:view_file' evidence.id %}" alt="{{ evidence.description }}" class="view-case-preview-image" />
      {% elif evidence.media_type == 'video' %}
      <video controls class="view-case-preview-video">
        <source src="{% url 'evidence:view_file' evidence.id %}" type="video/mp4">
        Your browser does not support the video tag.
      </video>
      {% elif evidence.media_type == 'audio' %}
      <audio controls class="view-case-preview-audio">
        <source src="{% url 'evidence:view_file' evidence.id %}" type="audio/mpeg">
        Your browser does not support the audio tag.
      </audio>
      {% else %}
      <div class="view-case-preview-placeholder">
        <div class="view-case-preview-icon">ðŸ“„</div>
        <div class="view-case-preview-text">Document Preview</div>
        <a href="{% url 'evidence:download_file' evidence.id %}" class="view-case-action-btn view-case-action-primary" download>Download File</a>
      </div>
      {% endif %}
    </div>
  </div>

  <div class="view-case-section">
    <h2 class="view-case-section-title">Evidence Details</h2>
    <div class="view-case-details-grid">
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">Status</span>
        <span class="view-case-detail-value">
          {% if evidence.media_status == 'Valid' %}
          <span class="view-case-status-badge view-case-status-open">{{ evidence.media_status }}</span>
          {% elif evidence.media_status == 'Invalid' %}
          <span class="view-case-status-badge view-case-status-invalid">{{ evidence.media_status }}</span>
          {% else %}
          <span class="view-case-status-badge view-case-status-archived">{{ evidence.media_status }}</span>
          {% endif %}
        </span>
      </div>
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">Media Type</span>
        <span class="view-case-detail-value">{{ evidence.get_media_type_display }}</span>
      </div>
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">Original Filename</span>
        <span class="view-case-detail-value">{{ evidence.original_filename }}</span>
      </div>
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">Immutable</span>
        <span class="view-case-detail-value">
          {% if evidence.is_immutable %}
          <span class="view-case-status-badge view-case-status-closed">Yes</span>
          {% else %}
          <span class="view-case-status-badge view-case-status-withdrawn">No</span>
          {% endif %}
        </span>
      </div>
    </div>
  </div>

  <div class="view-case-section">
    <h2 class="view-case-section-title">Hash Information</h2>
    <div class="view-case-details-grid">
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">SHA-256 Hash</span>
        <span class="view-case-detail-value" style="font-family: monospace; font-size: 13px; word-break: break-all;">{{ evidence.sha256_hash }}</span>
      </div>
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">MD5 Hash</span>
        <span class="view-case-detail-value" style="font-family: monospace; font-size: 13px; word-break: break-all;">{{ evidence.md5_hash }}</span>
      </div>
    </div>
  </div>

  {% if evidence.file_format or evidence.file_size or evidence.timestamp %}
  <div class="view-case-section">
    <h2 class="view-case-section-title">File-Level Metadata</h2>
    <div class="view-case-details-grid">
      {% if evidence.file_format %}
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">File Format</span>
        <span class="view-case-detail-value">{{ evidence.file_format }}</span>
      </div>
      {% endif %}
      {% if evidence.file_size %}
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">File Size</span>
        <span class="view-case-detail-value">{{ evidence.file_size }}</span>
      </div>
      {% endif %}
      {% if evidence.timestamp %}
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">Timestamp</span>
        <span class="view-case-detail-value">{{ evidence.timestamp }}</span>
      </div>
      {% endif %}
    </div>
  </div>
  {% endif %}

  {% if evidence.exif_data %}
  <div class="view-case-section">
    <h2 class="view-case-section-title">EXIF Data</h2>
    <div style="background: #f8fafc; padding: 16px; border-radius: 8px; font-family: monospace; font-size: 13px; color: #475569; white-space: pre-wrap; word-wrap: break-word;">{{ evidence.exif_data }}</div>
  </div>
  {% endif %}

  {% if evidence.authenticity_indicators %}
  <div class="view-case-section">
    <h2 class="view-case-section-title">Authenticity Indicators</h2>
    <div class="view-case-details-grid">
      <div class="view-case-detail-item">
        <span class="view-case-detail-label">Status</span>
        <span class="view-case-detail-value">{{ evidence.authenticity_indicators }}</span>
      </div>
    </div>
  </div>
  {% endif %}

  <div class="view-case-section">
    <h2 class="view-case-section-title">Actions</h2>
    <div class="view-case-actions">
      <a href="{% url 'cases:view_case' evidence.case.case_id %}" class="view-case-action-btn view-case-action-secondary">Back to Case</a>
      <a href="{% url 'evidence:download_file' evidence.id %}" class="view-case-action-btn view-case-action-secondary">Download</a>
      {% if user.is_staff %}
      <a href="{% url 'evidence:audit' evidence.id %}" class="view-case-action-btn view-case-action-secondary">Audit Log</a>
      {% endif %}
      {% if user.role == 'analyst' and not has_analysis %}
      <a href="{% url 'evidence:analyze' evidence.id %}" class="view-case-action-btn view-case-action-primary">Analyze</a>
      {% endif %}
      {% if user.role in 'analyst,investigator' %}
      <a href="{% url 'reports:evidence_reports' evidence.id %}" class="view-case-action-btn view-case-action-secondary">View Report</a>
      {% endif %}
      {% if user.is_staff or user.role == 'analyst' %}
      <a href="{% url 'evidence:verify' evidence.id %}" class="view-case-action-btn view-case-action-primary">Verify Integrity</a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}