{% extends 'base.html' %}
{% load static %}
{% block title %}Verify Evidence Integrity - {{ evidence.description }}{% endblock %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/evidence/verify_evidence.css' %}?v={{ STATIC_VERSION }}" />

<div class="view-case-container">
  <div class="view-case-header">
    <h1 class="view-case-title">Verify Evidence Integrity</h1>
    <div class="view-case-meta">
      <div class="view-case-meta-item">
        <span class="view-case-meta-label">Case:</span>
        <span class="view-case-meta-value">{{ evidence.case.case_id }}</span>
      </div>
      <div class="view-case-meta-item">
        <span class="view-case-meta-label">Evidence:</span>
        <span class="view-case-meta-value">{{ evidence.description }}</span>
      </div>
    </div>
  </div>

  <div class="view-case-section">
    <h2 class="view-case-section-title">Evidence Summary</h2>
    <div class="verify-evidence-summary">
      <div class="verify-evidence-row">
        <span class="verify-evidence-label">Description:</span>
        <span class="verify-evidence-description">{{ evidence.description }}</span>
      </div>
      <div class="verify-evidence-row">
        <span class="verify-evidence-label">Original filename:</span>
        <span class="verify-evidence-name">{{ evidence.original_filename }}</span>
      </div>
      <div class="verify-evidence-row verify-evidence-row-side">
        <div class="verify-evidence-hash">
          <span class="verify-evidence-hash-label">MD5</span>
          <span class="verify-evidence-hash-value">{{ evidence.md5_hash }}</span>
        </div>
        <div class="verify-evidence-hash">
          <span class="verify-evidence-hash-label">SHA-256</span>
          <span class="verify-evidence-hash-value">{{ evidence.sha256_hash }}</span>
        </div>
      </div>
      <div class="verify-evidence-row verify-evidence-row-side">
        <div class="verify-evidence-badge">
          <span class="verify-evidence-badge-label">Metadata Valid</span>
          {% if evidence.metadata_valid %}
          <span class="view-case-status-badge view-case-status-closed">Yes</span>
          {% else %}
          <span class="view-case-status-badge view-case-status-invalid">No</span>
          {% endif %}
        </div>
        <div class="verify-evidence-badge">
          <span class="verify-evidence-badge-label">Immutable</span>
          {% if evidence.is_immutable %}
          <span class="view-case-status-badge view-case-status-closed">Yes</span>
          {% else %}
          <span class="view-case-status-badge view-case-status-withdrawn">No</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  {% if not evidence.metadata_valid %}
  <div class="view-case-section" style="background: #fef3c7; border-left: 4px solid #f59e0b;">
    <h2 class="view-case-section-title" style="color: #92400e;">Metadata Issues</h2>
    <ul style="color: #78350f; margin: 0; padding-left: 20px;">
      {% for issue in evidence.metadata_issues %}
      <li>{{ issue }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <div class="view-case-section">
    <h2 class="view-case-section-title">Actions</h2>
    <div class="view-case-actions">
      {% if user.role == 'custodian' %}
      <a href="{% url 'custody:view_case_storage' evidence.case.case_id %}" class="view-case-action-btn view-case-action-secondary">Back to Storage</a>
      {% else %}
      <a href="{% url 'evidence:view' evidence.id %}" class="view-case-action-btn view-case-action-secondary">Back to Evidence</a>
      <a href="{% url 'cases:view_case' evidence.case.case_id %}" class="view-case-action-btn view-case-action-secondary">Back to Case</a>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}