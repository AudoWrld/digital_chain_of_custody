{% extends 'base.html' %}
{% block title %}Evidence Custody Log{% endblock %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/cases/case_list.css' %}?v={{ STATIC_VERSION }}" />

<div class="cases-page-header" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
  <div class="cases-page-title">
    <h1>Evidence Custody Log</h1>
  </div>
  <div class="cases-page-actions">
    <a href="{% url 'custody:view_case_storage' evidence.case.case_id %}" class="cases-create-btn">Back to Storage</a>
  </div>
</div>

<div class="view-case-section">
  <h2 class="view-case-section-title">Evidence Information</h2>
  <div class="view-case-details-grid">
    <div class="view-case-detail-item">
      <span class="view-case-detail-label">Description:</span>
      <span class="view-case-detail-value">{{ evidence.description }}</span>
    </div>
    <div class="view-case-detail-item">
      <span class="view-case-detail-label">Case:</span>
      <span class="view-case-detail-value">{{ evidence.case.case_id }}</span>
    </div>
  </div>
</div>

{% if logs %}
<div class="cases-table-wrapper">
  <table class="cases-data-table">
    <thead class="cases-table-head">
      <tr>
        <th class="cases-table-header">Timestamp</th>
        <th class="cases-table-header">Action</th>
        <th class="cases-table-header">User</th>
        <th class="cases-table-header">Details</th>
        <th class="cases-table-header">From Location</th>
        <th class="cases-table-header">To Location</th>
        <th class="cases-table-header">To User</th>
      </tr>
    </thead>
    <tbody class="cases-table-body">
      {% for log in logs %}
      <tr class="cases-table-row">
        <td class="cases-table-cell">{{ log.timestamp|date:"M d, Y H:i" }}</td>
        <td class="cases-table-cell">{{ log.get_action_display }}</td>
        <td class="cases-table-cell">
          {% if log.user %}
            {{ log.user.get_full_name|default:log.user.username }}
          {% else %}
            N/A
          {% endif %}
        </td>
        <td class="cases-table-cell">{{ log.details }}</td>
        <td class="cases-table-cell">
          {% if log.from_location %}
            {{ log.from_location.name }}
          {% else %}
            N/A
          {% endif %}
        </td>
        <td class="cases-table-cell">
          {% if log.to_location %}
            {{ log.to_location.name }}
          {% else %}
            N/A
          {% endif %}
        </td>
        <td class="cases-table-cell">
          {% if log.to_user %}
            {{ log.to_user.get_full_name|default:log.to_user.username }}
          {% else %}
            N/A
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="cases-empty-state">
  <p>No custody logs found for this evidence</p>
</div>
{% endif %}
{% endblock %}
