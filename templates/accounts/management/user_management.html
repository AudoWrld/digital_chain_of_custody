{% extends 'base.html' %}
{% block title %}User Management - ChainProof{% endblock %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/accounts/management.css' %}?v={{ STATIC_VERSION }}" />

<div class="management-page-header">
  <div class="management-page-title">
    <h1>User Management</h1>
  </div>
  <div class="management-page-actions">
    <a href="{% url 'accounts:user_list' %}" class="management-create-btn">
      <i class='bx bx-list-plus'></i>
      View All Users
    </a>
  </div>
</div>

<!-- Stats Cards -->
<div class="management-stats-grid">
  <div class="management-stat-card">
    <div class="management-stat-icon users">
      <i class='bx bx-users'></i>
    </div>
    <div class="management-stat-content">
      <h3>{{ total_users }}</h3>
      <p>Total Users</p>
    </div>
  </div>
  
  <div class="management-stat-card">
    <div class="management-stat-icon active">
      <i class='bx bx-user-check'></i>
    </div>
    <div class="management-stat-content">
      <h3>{{ active_users }}</h3>
      <p>Active Users</p>
    </div>
  </div>
  
  <div class="management-stat-card">
    <div class="management-stat-icon inactive">
      <i class='bx bx-user-x'></i>
    </div>
    <div class="management-stat-content">
      <h3>{{ inactive_users }}</h3>
      <p>Inactive Users</p>
    </div>
  </div>
  
  <div class="management-stat-card">
    <div class="management-stat-icon roles">
      <i class='bx bx-shield-quarter'></i>
    </div>
    <div class="management-stat-content">
      <h3>{{ users_by_role|length }}</h3>
      <p>Roles Active</p>
    </div>
  </div>
</div>

<!-- Alerts Section -->
{% if alerts %}
<div class="management-alerts-section">
  {% for alert in alerts %}
  <div class="management-alert {{ alert.type }}">
    <div class="management-alert-title">
      {% if alert.type == 'warning' %}
      <i class='bx bx-warning'></i>
      {% elif alert.type == 'error' %}
      <i class='bx bx-error-circle'></i>
      {% else %}
      <i class='bx bx-check-circle'></i>
      {% endif %}
      <h4>{{ alert.title }}</h4>
    </div>
    <div class="management-alert-message">
      {{ alert.message }}
      {% if alert.details %}
      <ul style="margin: 12px 0 0 20px; padding: 0;">
        {% for detail in alert.details|slice:":5" %}
        <li>{{ detail.user.get_full_name|default:detail.user.username }} - {{ detail.count }} {% if detail.count == 1 %}item{% else %}items{% endif %}</li>
        {% endfor %}
        {% if alert.details|length > 5 %}
        <li>...and {{ alert.details|length|add:"-5" }} more</li>
        {% endif %}
      </ul>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- Quick Actions -->
<div class="management-quick-actions">
  <a href="{% url 'accounts:user_list' %}" class="management-quick-action-card">
    <div class="management-quick-action-icon">
      <i class='bx bx-list-ul'></i>
    </div>
    <div class="management-quick-action-content">
      <h4>User List</h4>
      <p>View and manage all users</p>
    </div>
  </a>
  
  <a href="{% url 'accounts:user_list' %}?status=inactive" class="management-quick-action-card">
    <div class="management-quick-action-icon" style="background: #fee2e2; color: #dc2626;">
      <i class='bx bx-block'></i>
    </div>
    <div class="management-quick-action-content">
      <h4>Inactive Users</h4>
      <p>{{ inactive_users }} accounts disabled</p>
    </div>
  </a>
  
  <a href="{% url 'accounts:user_list' %}?role=admin" class="management-quick-action-card">
    <div class="management-quick-action-icon" style="background: #ede9fe; color: #5b21b6;">
      <i class='bx bx-crown'></i>
    </div>
    <div class="management-quick-action-content">
      <h4>Administrators</h4>
      <p>Manage admin accounts</p>
    </div>
  </a>
  
  <a href="{% url 'accounts:user_list' %}?role=custodian" class="management-quick-action-card">
    <div class="management-quick-action-icon" style="background: #fef3c7; color: #d97706;">
      <i class='bx bx-box'></i>
    </div>
    <div class="management-quick-action-content">
      <h4>Custodians</h4>
      <p>Manage evidence custodians</p>
    </div>
  </a>
</div>

<!-- Users by Role -->
<div class="management-detail-card" style="margin-bottom: 32px;">
  <div class="management-detail-header">
    <h2><i class='bx bx-pie-chart-alt-2'></i> Users by Role</h2>
  </div>
  <div class="management-detail-body">
    {% if users_by_role %}
    <div class="management-stats-grid" style="margin-bottom: 0;">
      {% for role_data in users_by_role.values %}
      <div class="management-stat-card">
        <div class="management-stat-icon" style="background: #f1f5f9; color: #475569;">
          <i class='bx bx-user'></i>
        </div>
        </div>
        <div class="management-stat-content">
          <h3>{{ role_data.count }}</h3>
          <p>{{ role_data.name }}</p>
        </div>
      </div>
      {% endfor %}
    </div>
    {% else %}
    <div class="management-empty-state" style="padding: 32px;">
      <p>No users with assigned roles yet.</p>
    </div>
    {% endif %}
  </div>
</div>

<!-- Recent Activity Summary -->
<div class="management-detail-grid">
  <div class="management-detail-card">
    <div class="management-detail-header">
      <h2><i class='bx bx-trending-up'></i> Activity Summary</h2>
    </div>
    <div class="management-detail-body">
      <div class="management-detail-row">
        <span class="management-detail-label">New Users (Last 7 Days)</span>
        <span class="management-detail-value">{{ recent_users }}</span>
      </div>
      <div class="management-detail-row">
        <span class="management-detail-label">Users Never Logged In</span>
        <span class="management-detail-value">{{ never_logged_in }}</span>
      </div>
      <div class="management-detail-row">
        <span class="management-detail-label">Users Without Roles</span>
        <span class="management-detail-value">{{ users_without_roles|default:0 }}</span>
      </div>
    </div>
  </div>
  
  <div class="management-detail-card">
    <div class="management-detail-header">
      <h2><i class='bx bx-cog'></i> Quick Actions</h2>
    </div>
    <div class="management-detail-body">
      <div class="management-actions">
        <a href="{% url 'accounts:user_list' %}" class="management-btn management-btn-primary">
          <i class='bx bx-list-ul'></i>
          Manage Users
        </a>
        <a href="#" class="management-btn management-btn-secondary">
          <i class='bx bx-export'></i>
          Export Report
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
