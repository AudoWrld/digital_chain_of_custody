{% extends 'accounts/base.html' %}
{% load static %}
{% block title %}Verify Recovery Code{% endblock %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/accounts/verify_recovery_code.css' %}?v={{ STATIC_VERSION }}" />
{% endblock %}
{% block content %}
    {% if messages %}
      <div class="toast-container">
        {% for message in messages %}
          <div class="toast {{ message.tags }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
    
    <div class="login-wrapper">
      <div class="login-card">
        <div class="login-brand">
          <img src="{% static 'images/logo.png' %}" alt="Logo" class="logo" />
          <div class="title">Chain of Custody</div>
        </div>

        <h2>Verify Recovery Code</h2>
        <p class="muted">Enter one of your unused recovery codes. Each code can be used only once.</p>

        <form method="post" novalidate>
          {% csrf_token %}
          <label for="recovery_code">Recovery code</label>
          <input
            type="text"
            id="recovery_code"
            name="recovery_code"
            inputmode="numeric"
            autocomplete="one-time-code"
            placeholder="XXXX-XXXX"
            maxlength="8"
            required
          />

          <button type="submit">Verify</button>
        </form>

        <div class="login-links">
          <a href="{% url 'login' %}">Back to Login</a>
        </div>

        <p class="muted small" style="margin-top:12px;">
          Lost your recovery codes? Contact support or generate new codes from your account settings after signing in.
        </p>
      </div>
    </div>

<script>
        document.addEventListener('DOMContentLoaded', function() {
            const toasts = document.querySelectorAll('.toast');
            toasts.forEach(toast => {
                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease-out forwards';
                    setTimeout(() => {
                        toast.remove();
                    }, 300);
                }, 5000);
            });
        });
    </script>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const recoveryCodeInput = document.getElementById('recovery_code');
        
        if (recoveryCodeInput) {
          recoveryCodeInput.addEventListener('input', function(e) {
            this.value = this.value.replace(/[^a-zA-Z0-9-]/g, '');
          });
          
          recoveryCodeInput.addEventListener('keypress', function(e) {
            if ([8, 9, 27, 13, 189].indexOf(e.keyCode) !== -1 ||
                (e.keyCode === 65 && (e.ctrlKey === true || e.metaKey === true)) ||
                (e.keyCode >= 35 && e.keyCode <= 40)) {
              return;
            }
            
            if (!((e.keyCode >= 48 && e.keyCode <= 57) ||
                  (e.keyCode >= 65 && e.keyCode <= 90) ||
                  (e.keyCode >= 97 && e.keyCode <= 122))) {
              e.preventDefault();
            }
          });
          
          recoveryCodeInput.addEventListener('paste', function(e) {
            const pastedData = (e.clipboardData || window.clipboardData).getData('text');
            const filteredData = pastedData.replace(/[^a-zA-Z0-9-]/g, '');
            
            if (pastedData !== filteredData) {
              e.preventDefault();
              document.execCommand('insertText', false, filteredData);
            }
          });
        }
      });
    </script>
{% endblock %}
