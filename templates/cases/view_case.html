{% extends 'base.html' %}
{% block title %}View Case{% endblock %}

{% block content %}
<h1>Case: {{ title }}</h1>
<p>Category: {{ category }}</p>
<p>Status: {{ case.case_status }}</p>

<h2>Media</h2>
{% if media_files %}
<ul>
    {% for media in media_files %}
    <li>
        {{ media.description }} -
        <a href="{% url 'view_media' media.id %}">Download</a> |
        {% if case.case_status not in 'Closed,Archived,Withdrawn,Invalid' %}
        <a href="{% url 'edit_media_description' media.id %}">Edit Description</a> |
        <a href="{% url 'mark_media_invalid' media.id %}">Mark Invalid</a> |
        {% endif %}
        <a href="{% url 'view_media_audit_log' media.id %}">Audit Log</a>
    </li>
    {% endfor %}
</ul>
{% else %}
<p>No media uploaded for this case. {% if case.case_status not in 'Closed,Archived,Withdrawn,Invalid' %}<a href="{% url 'upload_media' case.id %}">Upload Media</a>{% endif %}</p>
{% endif %}

<h2>Actions</h2>
{% if case.case_status not in 'Closed,Archived,Withdrawn,Invalid' %}
<a href="{% url 'upload_media' case.id %}">Upload Media</a> |
{% endif %}
{% if case.case_status == 'Open' or case.case_status == 'Under Review' %}
<a href="{% url 'edit_case' case.id %}">Edit Case</a> |
<a href="{% url 'assign_investigators' case.id %}">Assign Investigators</a> |
{% if not case.closure_requested %}
<a href="{% url 'request_case_closure' case.id %}">Request Closure</a> |
{% endif %}
<a href="{% url 'close_case' case.id %}">Close Case</a> |
<a href="{% url 'withdraw_case' case.id %}">Withdraw Case</a> |
<a href="{% url 'invalidate_case' case.id %}">Mark Invalid</a> |
{% endif %}
{% if case.case_status == 'Closed' %}
<a href="{% url 'archive_case' case.id %}">Archive Case</a> |
{% endif %}
{% if request.user.is_staff and case.case_status == 'Closed' and not case.closure_approved %}
<a href="{% url 'admin_approve_case_closure' case.id %}">Approve Closure</a> |
{% endif %}
<a href="{% url 'view_case_audit_log' case.id %}">Case Audit Log</a> |
<a href="{% url 'case_list' %}">Back to Cases</a>
{% endblock %}
